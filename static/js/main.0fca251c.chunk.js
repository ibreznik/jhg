(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(t,e,a){t.exports=a.p+"static/media/play.0c1ce2dd.svg"},24:function(t,e,a){t.exports=a.p+"static/media/check_blank.5e8e3bc4.svg"},25:function(t,e,a){t.exports=a.p+"static/media/check_full.07199ac9.svg"},26:function(t,e,a){t.exports=a.p+"static/media/pause.586f15b3.svg"},27:function(t,e,a){t.exports=a.p+"static/media/error.35a6ccb5.svg"},28:function(t,e,a){t.exports=a.p+"static/media/later.491fe89f.svg"},29:function(t,e,a){t.exports=a.p+"static/media/link.4c93145f.svg"},30:function(t,e,a){t.exports=a.p+"static/media/phone.d65f03f7.svg"},31:function(t,e,a){t.exports=a.p+"static/media/plus.4b3f33aa.svg"},33:function(t,e,a){t.exports=a(69)},39:function(t,e,a){},66:function(t,e,a){},69:function(t,e,a){"use strict";a.r(e);var n=a(0),s=a.n(n),i=a(13),r=a.n(i),o=(a(39),a(4)),c=a(5),l=a(8),u=a(6),d=a(7),h=a(71),g=a(72),p=a(1),m=function(t){function e(t){var a;return Object(o.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this,t))).handleChange=a.handleChange.bind(Object(p.a)(Object(p.a)(a))),a.keypress=a.keypress.bind(Object(p.a)(Object(p.a)(a))),a}return Object(d.a)(e,t),Object(c.a)(e,[{key:"handleChange",value:function(t){this.props.onChange(t.target.value)}},{key:"keypress",value:function(t){"Enter"===t.key&&(console.log("Enter pressed"),this.props.done())}},{key:"render",value:function(){var t=this.props.text;return s.a.createElement("input",{ref:"mainInput",className:"inputTask",type:"text",onChange:this.handleChange,value:t,onKeyPress:this.keypress})}}]),e}(n.Component),f=a(15),k=a.n(f),v=a(24),b=a.n(v),y=a(25),w=a.n(y),j=a(26),O=a.n(j),C=a(27),E=a.n(C),T=a(28),x=a.n(T),D=a(29),_=a.n(D),S=a(30),N=a.n(S),W=function(t){function e(t){var a;return Object(o.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this,t))).navigate=a.navigate.bind(Object(p.a)(Object(p.a)(a))),a}return Object(d.a)(e,t),Object(c.a)(e,[{key:"isMobileDevice",value:function(){return"undefined"!==typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}},{key:"navigate",value:function(t){window.open(t,"_blank"),this.props.onStart()}},{key:"render",value:function(){for(var t=this,e=this.props.started,a=this.props.done,n=this.props.edit,i=_.a,r=!1,o=!1,c=!1,l="",u=this.props.tags,d=u.length,h=0;h<d;h++){var g=u[h];"shallow"===g.name&&(r=!0),"deep"===g.name&&(o=!0),g.name.startsWith("link_")&&(g.name.substring(5).startsWith("tel")?this.isMobileDevice()&&(c=!0,l=g.name.substring(5),i=N.a):(c=!0,l=g.name.substring(5)))}var p=this.props.name;return a&&(p=s.a.createElement("s",null,p)),r&&(p=s.a.createElement("i",null,p)),o&&(p=s.a.createElement("b",null,p)),s.a.createElement("div",{className:"oneTask"},s.a.createElement("img",{className:"leftButton",src:n?E.a:e?O.a:c?i:k.a,alt:n?"Delete":e?"Pause":"Start",onClick:n?this.props.onDelete:c&&!e?function(){return t.navigate(l)}:this.props.onStart}),s.a.createElement("span",{onClick:this.props.taskSelected},p),s.a.createElement("img",{className:"rightButton",src:n?x.a:a?w.a:b.a,alt:n?"Postpone":a?"Uncomplete":"Complete",onClick:n?this.props.onPostpone:this.props.onComplete}))}}]),e}(n.Component),M=function(t){function e(){return Object(o.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return s.a.createElement("div",{className:"oneTask"},s.a.createElement("span",{onClick:this.props.onClick},this.props.name))}}]),e}(n.Component),A=function(t){function e(){return Object(o.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return s.a.createElement("div",{className:"oneTask"},s.a.createElement("span",{onClick:this.props.onClick},this.props.name))}}]),e}(n.Component),F=function(t){function e(){return Object(o.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return s.a.createElement("div",{className:"addFriend"},s.a.createElement("span",{onClick:this.props.onDone},"Not Ready"))}}]),e}(n.Component),P=a(16),I=a(12),L=a.n(I),z=a(31),U=a.n(z),Y=Object(P.SortableElement)(function(t){var e=t.value;return s.a.createElement("li",null,e)}),B=Object(P.SortableContainer)(function(t){var e=t.items;return s.a.createElement("ul",null,e.map(function(t,e){return s.a.createElement(Y,{key:"item-".concat(e),index:e,value:t})}))}),R=function(t){function e(t){var a;return Object(o.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this,t))).onSortEnd=function(t){var e=t.oldIndex,n=t.newIndex;a.setState({tasks:Object(P.arrayMove)(a.state.tasks,e,n)},function(){a.reorder()})},a.state={showing:"tasks",current_tag:a.today(),possible_tags:[],guesses:[],editing:"",edit:!1,tasks:[],friends:[],key:"2019",latest_type:"tag",new_task:{name:"",started:!1,times:[],done:[],tags:[{name:"",order:0}],aim_date:"",due_date:"",raw:"",users:[]},text:"",user:{name:"Ilya",id:"0"}},a.getTasks=a.getTasks.bind(Object(p.a)(Object(p.a)(a))),a.getTags=a.getTags.bind(Object(p.a)(Object(p.a)(a))),a.processText=a.processText.bind(Object(p.a)(Object(p.a)(a))),a.commitAndClear=a.commitAndClear.bind(Object(p.a)(Object(p.a)(a))),a.commitTask=a.commitTask.bind(Object(p.a)(Object(p.a)(a))),a.textChanged=a.textChanged.bind(Object(p.a)(Object(p.a)(a))),a.complete=a.complete.bind(Object(p.a)(Object(p.a)(a))),a.postpone=a.postpone.bind(Object(p.a)(Object(p.a)(a))),a.start=a.start.bind(Object(p.a)(Object(p.a)(a))),a.delete_task=a.delete_task.bind(Object(p.a)(Object(p.a)(a))),a.onSortEnd=a.onSortEnd.bind(Object(p.a)(Object(p.a)(a))),a.addTask=a.addTask.bind(Object(p.a)(Object(p.a)(a))),a.show=a.show.bind(Object(p.a)(Object(p.a)(a))),a.sync=a.sync.bind(Object(p.a)(Object(p.a)(a))),a.reorder=a.reorder.bind(Object(p.a)(Object(p.a)(a))),a.componentDidMount=a.componentDidMount.bind(Object(p.a)(Object(p.a)(a))),a.taskSelected=a.taskSelected.bind(Object(p.a)(Object(p.a)(a))),a}return Object(d.a)(e,t),Object(c.a)(e,[{key:"show",value:function(t){if("tags"===t){for(var e=this.state.possible_tags,a=e.length-1;a>=0;a--)(e[a].startsWith("link_")||e[a].startsWith("default_"))&&e.splice(a,1);this.setState({possible_tags:e,showing:t})}else this.setState({showing:t})}},{key:"componentDidMount",value:function(){this.getTasks(),this.getTags()}},{key:"sync",value:function(){this.reorder(),this.getTasks(),this.getTags()}},{key:"getTasks",value:function(){var t=this,e=this.state.current_tag;L.a.get("https://api.ibreznik.com/now",{params:{tag:e,key:this.state.key}}).then(function(t){return t.data}).then(function(a){a.sort(function(t,a){return t.tags.find(function(t){return t.name===e}).order-a.tags.find(function(t){return t.name===e}).order}).reverse(),t.setState({tasks:a})})}},{key:"componentWillUnmount",value:function(){this.reorder()}},{key:"reorder",value:function(){for(var t=this,e=this.state.tasks.slice(),a=e.length,n=0;n<a;n++)e[n].tags.find(function(e){return e.name===t.state.current_tag}).order=a-n,this.update(e[n])}},{key:"update",value:function(t){this.setState({editing:""}),L.a.put("https://api.ibreznik.com/task",t)}},{key:"getTags",value:function(){var t=this;L.a.get("https://api.ibreznik.com/tags").then(function(e){return t.setState({possible_tags:e.data.sort()})}).then(function(t){})}},{key:"addFriend",value:function(t){}},{key:"twoDigit",value:function(t){return(t<10?"0":"")+t}},{key:"today",value:function(){var t=new Date;return""+t.getFullYear()+this.twoDigit(t.getMonth()+1)+this.twoDigit(t.getDate())}},{key:"tomorrow",value:function(){var t=new Date,e=new Date;return e.setDate(t.getDate()+1),""+e.getFullYear()+this.twoDigit(e.getMonth()+1)+this.twoDigit(e.getDate())}},{key:"weekday",value:function(t){var e=new Date;return e.setDate(e.getDate()+(7-e.getDay())%7+t),""+e.getFullYear()+this.twoDigit(e.getMonth()+1)+this.twoDigit(e.getDate())}},{key:"alternate",value:function(){var t=new Date,e=new Date;return e.setDate(t.getDate()+2),""+e.getFullYear()+this.twoDigit(e.getMonth()+1)+this.twoDigit(e.getDate())}},{key:"workday",value:function(){var t=new Date;do{t.setDate(t.getDate()+1)}while(!(t.getDay()%6));return""+t.getFullYear()+this.twoDigit(t.getMonth()+1)+this.twoDigit(t.getDate())}},{key:"replaceTag",value:function(t){return"today"===t?this.today():"tomorrow"===t?this.tomorrow():"monday"===t?this.weekday(1):"tuesday"===t?this.weekday(2):"wednesday"===t?this.weekday(3):"thursday"===t?this.weekday(4):"friday"===t?this.weekday(5):"saturday"===t?this.weekday(6):"sunday"===t?this.weekday(0):"workday"===t?this.workday():"alternate"===t?this.alternate():t}},{key:"processText",value:function(){for(var t=this.state.text,e=(t=(t=t.replace("^","#link_")).replace("*","#default_")).split(" ").filter(function(t){return t.startsWith("#")}),a=[],n=0;n<e.length;n++)t=t.replace(e[n],""),e[n]=e[n].replace("#","").toLowerCase(),e[n]=this.replaceTag(e[n]),a.push({name:e[n],order:0});a.push({name:"",order:0}),t=t.trim();var s=this.state.text;this.setState({text:t});var i=t.split(" ").filter(function(t){return t.startsWith("~")});if(i.length>0){t=t.replace(i[0],"");var r=i[0].substring(1).split("-");if(2===r.length)return{text:t,tags:a,raw:s,est_low:r[0],est_high:r[1]};if(1===r.length)return{text:t,tags:a,raw:s,est_low:r[0]}}return{text:t,tags:a,raw:s}}},{key:"commitAndClear",value:function(t){this.commitTask(t),this.setState({text:""})}},{key:"commitTask",value:function(t){var e=this;L.a.post("https://api.ibreznik.com/task",t).then(function(t){var a=e.state.tasks,n=a.findIndex(function(t){return void 0===t._id});n>=0&&(a[n]._id={$oid:t.data},e.setState({tasks:a}))})}},{key:"addTask",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t?[(new Date).getTime()]:[],a=this.processText(),n={name:a.text,tags:a.tags,times:e,started:t,done:!1,delays:0,raw:a.raw};"est_high"in a&&(n.est_high=parseFloat(a.est_high)),"est_low"in a&&(n.est_low=parseFloat(a.est_low));for(var s=this.state.tasks,i=n.tags.length,r=0;r<i;r++)this.state.current_tag===n.tags[r].name&&s.push(n);this.setState({tasks:s}),this.commitAndClear(n)}},{key:"textChanged",value:function(t){this.setState({text:t})}},{key:"createTag",value:function(t){}},{key:"setCurrentPerson",value:function(t){}},{key:"setCurrentTag",value:function(t){var e=this;this.setState({current_tag:t},function(){e.getTasks(),e.setState({showing:"tasks"})})}},{key:"addTagToCurrent",value:function(t){}},{key:"complete",value:function(t){var e=this,a=this.state.tasks.slice();a[t].done=!a[t].done,a[t].started&&(a[t].started=!a[t].started,a[t].times.push((new Date).getTime())),this.setState({tasks:a}),this.update(a[t]);for(var n=a[t].tags.length,s=0;s<n;s++){"repeat"===a[t].tags[s].name&&this.setState({text:a[t].raw},function(){e.addTask()})}}},{key:"postpone",value:function(t){for(var e=this.state.tasks.slice(),a=e[t].tags,n="unassign",s=-1,i=0;i<a.length;i++)a[i].name===this.today()?s=i:a[i].name.startsWith("default_")&&(n=a[i].name.substring(8));if(e[t].delays=e[t].delays+1,this.state.text.startsWith("#")){var r=this.state.text.replace("#","").toLowerCase();"#today"===this.state.text?r=this.today():"#tomorrow"===this.state.text&&(r=this.tomorrow()),a.push({name:r,order:0})}else if("unassign"===n)alert("No time provided! Date was unassigned");else if("next"===n)for(i=0;i<a.length;i++){var o=a[i].name;a[i].name===this.today()&&(a[i].name="tomorrow"),a[i].name=this.replaceTag(a[i].name),a[i].name!==o&&(a[i].order=0)}else"tomorrow"===n&&a.push({name:this.replaceTag("tomorrow"),order:0});s>-1&&a.splice(s,1),e[t].tags=a,this.update(e[t]),e.splice(t,1),this.setState({tasks:e})}},{key:"start",value:function(t){var e=this.state.tasks.slice();e[t].started=!e[t].started,e[t].times.push((new Date).getTime()),e[t].done&&(e[t].done=!1);for(var a=!1,n=e[t].tags.length,s=0;s<n;s++){var i=e[t].tags[s];if(i.name===this.today()){a=!0;var r=this.state.tasks.length;e[t].tags[s].order=r-1}if(i.name===this.state.current_tag){var o=this.state.tasks.length;e[t].tags[s].order=o-1}}a||e[t].tags.push({name:this.today(),order:0}),this.setState({tasks:e}),this.update(e[t])}},{key:"delete_task",value:function(t){var e=this,a=this.state.tasks.slice();L.a.delete("https://api.ibreznik.com/task",{params:{id:a[t]._id.$oid}}).then(function(t){return e.sync()})}},{key:"taskSelected",value:function(t){var e=this.state.tasks.slice();this.setState({editing:e[t]._id.$oid},this.setState({text:e[t].raw}))}},{key:"getLatestTag",value:function(){}},{key:"render",value:function(){var t=this,e=this.state.showing,a=this.state.latest_type,n=this.getLatestTag(),i=this.state.edit,r=0,o=0;for(var c in this.state.tasks)if(!this.state.tasks[c].done)for(var l in this.state.tasks[c]){var u=this.state.tasks[c].times,d=-1,h=0;for(var g in u)h+=d*u[g],d=1;h<0&&(h+=(new Date).getTime()),"est_low"===l?r=Math.max(r+this.state.tasks[c][l]-h/1e3/60,0):"est_high"===l&&(o=Math.max(o+this.state.tasks[c][l]-h/1e3/60,0))}var p=this.state.current_tag+" ("+(r/60).toFixed(2)+"-"+(o/60).toFixed(2)+")",f="";"tasks"===e?f=this.state.tasks.map(function(e,a){return s.a.createElement(W,{name:e.name,id:e._id,started:e.started,done:e.done,tags:e.tags,onStart:function(){return t.start(a)},onDelete:function(){return t.delete_task(a)},taskSelected:function(){return t.taskSelected(a)},onComplete:function(){return t.complete(a)},onPostpone:function(){return t.postpone(a)},edit:i})}):"guess"===e?f=this.state.possible_tags.map(function(e,a){return s.a.createElement(A,{name:e,onClick:function(){return t.addTagToCurrent(a)}})}):"tags"===e&&(console.log(this.state.possible_tags),"tag"===a?f=this.state.possible_tags.map(function(e,a){return s.a.createElement(A,{name:e,onClick:function(){return t.setCurrentTag(e)}})}):"user"===a&&(f=this.state.friends.map(function(e,a){return s.a.createElement(M,{name:e,onClick:function(){return t.setCurrentPerson(a)}})})));var v="";return"guess"===e?"tag"===a?v=s.a.createElement("div",{className:"createNewTag",onClick:function(){return t.createTag(n)}},'"Create new tag "+tag'):"user"===a&&(v=s.a.createElement(F,{onDone:this.addFriend})):v=s.a.createElement("div",{className:"controls"},s.a.createElement("div",{className:"rightControl",onClick:function(){return t.setState({edit:!t.state.edit})}},"Edit"),s.a.createElement("div",{className:"leftControl",onClick:this.sync},"Sync"),s.a.createElement("center",null,"tasks"===e?s.a.createElement("div",{className:"centerControl",onClick:function(){return t.show("tags")}}," ",p," "):s.a.createElement("div",{className:"centerControl",onClick:function(){return t.setCurrentTag("")}}," Show all"))),s.a.createElement("div",{className:"main"},s.a.createElement("div",{className:"top"},s.a.createElement("img",{className:"add",src:U.a,alt:"Add",height:"35",onClick:function(){return t.addTask(!1)}}),s.a.createElement("img",{className:"addAndStart",src:k.a,alt:"Start",height:"35",onClick:function(){return t.addTask(!0)}}),s.a.createElement("center",null,s.a.createElement(m,{text:this.state.text,done:this.addTask,onChange:this.textChanged}))),v,s.a.createElement("div",{className:"body"},s.a.createElement(B,{items:f,distance:2,onSortEnd:this.onSortEnd})))}}]),e}(n.Component),$=(a(66),function(t){function e(){return Object(o.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return s.a.createElement(h.a,null,s.a.createElement(g.a,{exact:!0,path:"/",render:function(t){return s.a.createElement(R,null)}}))}}]),e}(n.Component)),J=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function K(t,e){navigator.serviceWorker.register(t).then(function(t){t.onupdatefound=function(){var a=t.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(function(t){console.error("Error during service worker registration:",t)})}r.a.render(s.a.createElement($,null),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("/jhg",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/jhg","/service-worker.js");J?(function(t,e){fetch(t).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(t){t.unregister().then(function(){window.location.reload()})}):K(t,e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):K(e,t)})}}()}},[[33,2,1]]]);
//# sourceMappingURL=main.0fca251c.chunk.js.map